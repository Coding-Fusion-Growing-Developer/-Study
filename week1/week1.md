## 1. 데이터 모델링 이론

### 데이터 모델링이란
데이터 모델
- 현실 세계의 정보나 데이터를 시스템으로 구축하기 위해 추상화하여 체계적으로 표현한 모형

데이터 모델링
- 영속성을 갖는 데이터에 대한 시스템 구조를 사람이 이해할 수 있도록 형상화 하는 과정
- 정보로 인지, 식별(개념적) -> 기호 등으로 추상화(논리적) -> 데이터베이스로 구축(물리적)

데이터 모델의 종류
- 개체 관계 모델(Entity-Relationship Model)
  - 가장 대표적인 데이터 모델
  - 인식(개념) 단계의 데이터 모델을 지향
  - 많은 프로젝트에서 사용, 관계형 모델과 관계형 데이터베이스를 통해 저장, 관리
- 관계 모델(Relational Model)
- 계층 모델(Hierarchical Model)
- 망 모델(Network Model)

데이터 모델링 작업
- 현업 인터뷰, 업무 지침서, 용어집, 산출물 등 현행 업무 파악 -> 엔티티, 속성, 관계로 형상화
  - 엔티티: 복합 정보
  - 속성: 단일 정보
  - 슈퍼타입 서브타입으로 집합 정의

ER모델
- ER 모델은 표현하고자 하는 현실 세계의 업무를 개체와 관계라는 두 가지 개념으로 표현
- 비교적 이해하기 쉽고 모델 확장이 가능해 가장 널리 활용
- ERD: ER 모델에서 사용하는 실체와 관계를 도식화 한 것
- ER 표기법: 규약인 동시에 언어

ER 모델의 질적 특성
- 완전성
  - ER 모델은 현실세계의 모든 업무적인 요구 사항을 표현해야 함
  - 요구사항에 대한 상세 내용을 검토해 모델에 모두 표현되어 있는지, 요구사항을 만족하는지 검토해야함
- 정확성
  - ER 모델의 개념대로 데이터모델을 작성해야 한다.
  - 엔티티 대신 속성을 사용하지 않아야 하고
  - 슈퍼타입 관계를 명확히 상속을 표현하고
  - 관계와 관련된 개별 엔티티를 명확히 정의해야 함
  - 관계 대신 엔티티를 사용하지 않아야 하고
  - 실체의 식별자를 명확히 해야 하며
  - 카디널리티와 옵셔널리티를 명확하게 표현해야 한다
- 최소성
  - 요구사항의 모든 특성이 ER 모델에 한 번만 나타나도록 설계해야 함
  - 중복이 나타단다면 중복 데이터를 반드시 문서화
- 자명성
  - 별도 보조자료 업시 설명이나 증명을 하지 않아도 요구사항에 대한 뜻이나 의미를 명확히 설명할 수 있어야 한다
- 확장성
  - 향후 업무 범위가 확대되거나 변경될 경우 새로운 요구사항을 쉽게 반영할 수 있도록 유연한 모델을 설계해야 한다
  - 대표적인 방법은 엔티티를 일반화 하여 엔티티를 통합하는 것
- 표현성
  - 요구사항을 자연스럽게 표현하고 추가적인 설명 없이도 ER모델의 의미를 쉽게 이해할 수 있도록 명확하게 설계
- 가독성
  - ER 모델을 읽기 쉽고 그 뜻을 쉽게 알아차릴 수 있도록 표현해야 함
  - 일반적으로 위에서 아래로, 왼쪽에서 오른쪽으로 표현

### ER 모델 구성 요소

구성요소: 엔티티, 관계, 속성

엔티티
- 고객, 상품, 직원처럼 현실 세계에 실제로 존재하는 실체이거나 조직, 서비스, 직업처럼 개념적인 것
- 업무를 구현하는 데 필요하고 관리해야 하는 주체, 대상, 행위 등 모든 집합적인 것
- 적어도 둘 이상의 인스턴스가 존재할 수 있어야 하고, 최소한 둘 이상의 속성이 있어야 한다.
- 반드시 각 인스턴스를 식별할 수 있는 속성이나 관계가 하나 이상 정의되어야 한다.
- 엔티티는 슈퍼타입 엔티티나 서브타입 엔티티로 확장할 수 있다.
- 슈퍼타입, 서브타입 엔티티는 일반화/특수화 과정을 통해 도출된다.
- 슈퍼타입 엔티티는 하나 이상의 서브타입 엔티티와 관계된 일반화된 엔티티이며, 서브타입에 공통으로 존재하는 속성을 관리한다.
- 서브타입 엔티티는 각각의 서브타입에만 존재하는 고유한 속성을 관리한다.
- 서브타입은 슈퍼타입의 식별자, 속성, 관계 등 모든 속성을 상속받는다.
- <b>부모클래스와 자식 클래스의 상속 느낌.</b>
- 일반화
  - 엔티티 각각이 가지고 있는 고유한 특징을 일반화하여 공통의 속성으로 재정의한 것
  - 엔티티를 일반화하면서 여러 개의 엔티티를 하나의 공통된 엔티티로 만들 수 있다.
  - 엔티티 일반화는 두개 이상의 하위 수준 엔티티를 결합하여 상위 수준의 엔티티로 통합하는 상향식 접근 방식이다.
  - 상위 수준의 엔티티와 하위 수준의 엔티티를 일반화하여 표현할 수도 있다.
  - 예시로, 본부, 팀과 같은 조직이나 대분류, 중분류, 소분류 산업분류 코드처럼 계층 관계를 가지는 엔티티를 일반화 하는 경우
  - 일반화는 인스턴스 존재 유형에 따라 완전/불완전, 배타적/포괄적 일반화로 나눌 수 있다.
  - 일반화 유형이 상위 수준 엔티티의 인스턴스에 모두 존재하느냐 일부 존재하느냐에 따라 완전 일반화와 불완전 일반화로 나눌 수 있다.
  - 배타적 일반화와 포괄적 일반화의 구분은 상위 수준 엔티티의 모든 인스턴스가 하위 수준 엔티티 중 하나에만 존재한다면 배타적 일반화이고, 둘 이상의 하위 엔티티에 속한다면 포괄적 일반화에 해당한다.
  - 사람을 성별로 구분할 경우 남자나 여자 둘 중 하나에는 반드시 존재해야 하므로 완전 일반화 성격을 가지게 되고, 남자나 여자 둘 중 하나만 속해야 하므로 배타적이다.
  - 학교 구성원의 하위 수준 엔티티를 교수와 학생으로 구분할 경우 교직원을 포함하지 않으므로 불완전한 집합이 되고, 교수이면서 학생이 될 수 있으므로 포괄적인 성격을 가지게 된다.
  - 배타적 / 포괄적 일반화에는 장단점이 있기에 판단하여 일반화 할 것
- 특수화
  - 특수화는 일반화의 반대 개념으로, 하나의 상위 수준 엔티티를 두 개 이상의 하위 수준 엔티티로 분할하는 하향식 접근 방식
  - 일반적으로 슈퍼타입을 정의하고, 서브타입과 속성을 정의한 후 관계를 정의한다.
- 집단화
  - 기본 ER 모델의 표기법은 다른 관계를 포함하는 관계를 표현할 수 없다.
  - 이를 해결하기 위해 엔티티간의 관계를 단일 엔티티로 재정의 한 것이다.
  - 집단화는 하나의 엔티티로 취급되는 두 개 엔티티 사이에서 나타나며, 해당 엔티티와의 관계가 상위 수준 엔티티로 대체된다.
- 엔티티 분류
  - 엔티티는 엔티티 관계, 엔티티 형태, 엔티티 생성 관점, 엔티티의 유무형 형태 등 바라보는 관점에 따라 다양하게 분류할 수 있다.
  - 엔티티 관계
    - 강한 엔티티
      - 독립적으로 존재하며, 엔티티 내에서 자체 식별자를 사용하여 고유하게 인스턴스를 식별할 수 있는 엔티티. ex) 고객, 상품
    - 약한 엔티티
      - 다른 엔티티에 종속적이며, 자체 식별자를 가지지 못하고, 다른 엔티티의 식별자를 상속받아 사용하는 엔티티. ex) 주문에서 주문번호 속성을 상속받아 식별자로 사용하는 주문상품
  - 엔티티 형태
    - 독립 엔티티
      - 사람, 물건, 장소, 개념처럼 원래부터 현실에 존재하는 엔티티. ex) 고객, 상품, 창고, 조직
    - 업무중심 엔티티
      - 업무를 처리하면서 발생하는 데이터에 해당하는 엔티티. 주제영역에서 가장 핵심이 되는 엔티티로, 통상 주제영역 이름과 동일하거나 비슷한 의미의 이름을 가짐. ex) 주문, 결제, 배송, 청구
    - 종속 엔티티
      - 업무중심 엔티티에서 1차 정규화로 인해 분리된 엔티티에 해당. ex) 주문상품, 주문배송 엔티티는 주문 엔티티가 있어야 존재할 수 있는 엔티티이며, 주문 엔티티의 종속 엔티티에 해당
    - 교차 엔티티
      - 두 개 이상의 엔티티 간에 발생하는 트랜잭션에 의해 생성되는 엔티티. 대부분 논리 모델링에서 다대다 관계를 해소하기 위해 도출 ex) 고객과 역할 간의 관계 엔티티인 고객역할 엔티티
  - 엔티티 생성 관점
    - 핵심 엔티티
      - 자신의 부모 엔티티를 갖지 않는 독립적이며, 핵심적인 엔티티 ex) 고객, 상품, 조직
    - 메인 엔티티
      - 핵심 엔티티 간의 거래 관계에 의해 생성되는 엔티티, 업무의 핵심이 되는 엔티티 ex) 고객과 상품의 거래 관계에 의해 생성된 계약 엔티티, 고객과 상품을 부모로 갖는다.
    - 행위 엔티티
      - 실제 업무 행위에 의해서 지속해서 발생하는 거래 행위에 대한 엔티티. ex) 청구내역 엔티티는 중요 엔티티에 해당하는 게약에 의해 지속해서 발생하는 데이터를 관리하는 엔티티
  - 엔티티 유무형
    - 실체 엔티티
      - 눈으로 볼 수 있는 물리적인 형태를 가지는 엔티티 ex) 고객, 상품
    - 개념 엔티티
      - 물리적인 형태는 없으나 개념적으로 존재하는 비실체 엔티티 ex) 조직, 보험상품, 서비스
    - 사건 엔티티
      - 업무 행위와 관련된 비실체 엔티티, 데이터가 빈번하게 생성되고 변경되는 특성이 있음. ex) 계약, 주문, 결제
  - 일반적으로 좋은 분류 방법은 특징이나 성질 등 기준에 따라 분류할 때, 전체를 포함하고, 서로 겹치지 않고 배타적으로 되도록 분류 기준을 정한다.
  - 다만 앞서서 살펴본 유형들은 기준이 모호해 사람마다 다르게 분류하거나, 겹치는 부분이 있어 실제 구분, 분류의 목적보다는 엔티티를 식별하거나 성격을 파악하는 용도로만 활용하는 것이 좋다.
  - 이 책에서는 핵심 엔티티, 중요 엔티티, 행위 엔티티 등 엔티티 생성 관점에 따른 분류를 주로 사용할 것이다.

관계
- 엔티티와 엔티티 간에 존재하는 업무 규칙을 정의하고, 엔티티 간에 어떤 관계가 이루어질 수 있는지 표현한다.
- 관계는 관계수(cardinality), 선택성(optionality), 식별성(Identifier Inheritance), 관계명 등으로 구성된다.
- 관계수(Cardinality)
  - 어떤 엔티티의 인스턴스 하나가 다른 엔티티 몇 개 인스턴스와 대응될 수 있는지를 표시
  - 상대 엔티티쪽에 까마귀 발로 표시한다. 최대 인스턴스 수와 관련이 있다.
- 선택성(optionality)
  - 해당 엔티티 인스턴스에 대해 상대 엔티티에 인스턴스가 반드시 존재해야 하는지, 존재하지 않아도 되는지 표시한다. 최소 인스턴스 수와 관련이 있다.
- 식별자 상속(Identifier Inheritance)
  - 엔티티 간의 관계를 정의하면서 엔티티의 식별자를 다른 엔티티에서 상속받을 때 식별자로 상속받을지(식별관계), 일반 속성으로 상속받을지(비식별관계) 표시한다.
- 관계명(Relationship Name)
  - 관계의 의미나 이름을 표시한다. 의미를 명확하게 표시한다는 측면에서 양쪽에 모두 기술하기도 하며, 관계선만으로도 의미가 통하는 경우 이름을 생략해도 무방하다.
- 관계수
  - 엔티티와 엔티티 간의 대응되는 최대 인스턴스 수를 말한다.
  - 일대일(1:1), 일대다(1:M), 다대다(M:N) 3가지 유형이 았다.
  - 일대일(1:1) 관계
    - 엔티티 개체 하나가 다른 엔티티 개체 하나와 관계를 가지는 경우
    - 실제 1:1 관계는 많이 발생하는 편은 아니다.
    - ex) 직원은 한번의 인턴과정을 거쳐 채용될 수 있으며, 하나의 인턴과정은 한 직원과 관련이 있다.
  - 일대다(1:M) 관계
    - 엔티티 개체 하나가 다른 엔티티 개체 여러 개와 관련이 있다.
    - ex) 한 부서에 직원 여러 명이 소속되어 있으며, 직원은 한 부서에만 소속될 수 있다.
  - 다대다(M:N) 관계
    - 어떤 엔티티 개체 하나가 다른 엔티티 개체 여러 개와 관련이 있고, 다른 엔티티 개체 하나는 어떤 엔티티 개체 여러 개와 관계가 있다.
    - ex) 학생은 여러 개 수강과목을 신청할 수 있고, 수강과목은 여러 명의 학생에 의해 선택된다.
- 관계 선택성
  - 엔티티 인스턴스에 대해 상대 엔티티 인스턴스 존재 유무를 나타내며, 양쪽 필수, 한쪽 필수, 양쪽 선택으로 나누어진다.
  - 필수 - 필수 관계
    - 양 쪽 모두 존재해야만 하는 경우
    - ex) 상품을 선택하지 않고 주문을 하는 경우는 없으므로, 주문은 주문상품이 반드시 존재, 반대로 주문상품도 주문이 반드시 존재해야 함
  - 필수 - 선택 관계
    - 한쪽은 존재해야만 하고, 한쪽은 필수가 아닌 경우
    - ex) 주문하지 않은 고객은 있을 수 있으나, 모든 주문은 반드시 주문한 고객이 있어야 한다.
  - 선택 - 선택 관계
    - 어떤 엔티티 인스턴스에 대해 다른 엔티티 인스턴스가 존재하지 않아도 되고, 다른 엔티티 인스턴스에 대해 어떤 엔티티 인스턴스도 존재하지 않아도 된다.
    - 종속 관계보다는 단순 참조관계일 때 자주 나타난다.
    - ex) 사원은 소개사원으로 등록된 계좌가 존재하지 않을 수 있고, 고객이 펀드상품에 가입할 때 소개사원을 지정하지 않아도 되므로 계좌는 소개 사원이 존재하지 않을 수 있다.
- 식별자 상속
  - 식별 관계
    - 참조되는 상위 엔티티 식별자가 참조하는 하위 엔티티 식별자로 상속되는 경우
    - 라운드 있는 엔티티 형태로 표기
    - PK가 FK인 경우?
  - 비식별 관계
    - 식별자가 아닌 일반 속성으로 상속되는 관계.
    - 사각형 모양 엔티티로 표기
    - PK랑 FK랑 상관없는 경우? 또는 composite키(복합키) 인경우에도 형식상으로는 비식별 관계
- 관계 유형
  - 기본 관계
    - 엔티티와 엔티티가 하나의 관계
    - 가장 일반적인 관계이며, 1:1 또는 1:M 관계에 해당
    - ex) 부서에는 여러 명의 사원이 소속된다.
  - 재귀적 관계
    - 하나의 엔티티가 다른 엔티티가 아닌 자기 자신과 관계
    - 계층적인 구조를 표현하는데 유용함
    - 필수 관계를 가질 수 없으며, 선택 관계만 가능하다. 조직과 같은 계층 구조의 추가 및 삭제 등의 변경에 쉽게 대응할 수 있다.
    - ex) 본부(상위 부서)는 여러 하위 부서로 구성된다.
  - 병렬 관계
    - 엔티티와 엔티티 간에 두 개 이상의 관계를 맺는다.
    - 두 엔티티 간의 관계가 2~3개로 적거나, 더 늘어나지 않으면 병렬로 표현해도 무방하나,
    - 관계가 많거나 추가될 가능성이 있다면, 여러개의 관계로 표현하는 대신 계약당사자 엔티티로 대체하는 것을 고려해야 한다.
    - 병렬 관계가 많아지면 특정 고객 데이터를 찾기 어렵거나, 물리 설계 시 인덱스를 여러 개 생성해야 할 수도 있다.
    - ex) 고객은 보험 계약의 계약자이면서 피보험자이기도 하다.
  - 슈퍼타입/서브타입 관계
    - 공통 속성을 관리하느 슈퍼타입 엔티티와 개별 속성을 관리하는 서브타입 엔티티는 배타적/포괄적인 관계를 가진다.
    - ex) 슈퍼타입 엔티티인 고객은 서브타입에 해당하는 개인이나 법인 둘 중 하나에 반드시 속한다.
  - 배타적인 관계
    - 엔티티가 두 개 이상의 다른 엔티티의 합집합과 관계를 가질 때, 배타적인 관계 또는 아크 관계라고 한다.
    - 동일한 의미를 가지는 관게에 대해 서로 다른 하나 이상 엔티티와 관계를 통합할 때 발생한다.
    - ex) 게인계좌, 법인계좌, 단체계좌를 통합한 계좌(FK가 여러 엔티티의 키와 연결됨)
- 관계 차원
  - 관계에 참여하는 엔티티의 수
  - 단항 관계
    - 부서 엔티티 내에서 부서와 상위 부서 관계처럼 하나의 엔티티 내에 존재하는 관계(재귀적 관계인 경우)
  - 이항 관계
    - 부서와 사원, 고객과 주문 등 두 개 엔티티 간의 관계에 해당. 가장 일반적인 형태
  - 삼항 관계
    - 세 개 엔티티 간의 관계에 해당하며, ERwin과 같은 Case 툴에서 지원하지 않는 관계
    - 흔하게 나타나는 편은 아니기 때문에, 진짜 삼항 관계인지, 아니면 이항 관계를 삼항 관계로 잘못 표현한 것인지 확인해야 함

속성
- 속성은 데이터를 표현하는 가장 작은 단위(테이블의 필드)
- 속성이 가지는 의므를 통해 엔티티 특성이나 상태를 알 수 있다.
- 하나의 엔티티는 두 개 이상의 속성을 가지며, 속성명, 식별자여부, 옵셔널리티, 도메인 등으로 구성된다.
- 속성명
  - 실체의 특성을 규정하는 속성 명칭으로 주문번호, 주문일자 등 업무에서 일반적으로 사용하는 용어를 사용하거나, 속성 의미를 명확하게 표현할 수 있도록 함축성 있는 명사를 사용하여 명명한다.
  - 일반적으로 속성명은 표준용어로 등록하고, 표준단어를 조합하여 구성한다.
- 식별자여부
  - 해당 속성이 엔티티 식별자에 해당하는지 표시한다
- 옵셔널리티
  - 엔티티에 인스턴스가 발생할 때 해당 속성이 반드시 특정 값을 가져야 하는지에 대한 구분으로, Mandatory(필수), Optional(필수아님), Conditional(조건적 필수)로 구분
- 도메인
  - 속성이 허용하는 데이터 형식과 범위를 가지고 있으며, 문자형, 숫자형, 날짜형 등이 있다
- 속성 값의 구성이나 성격에 따른 속성의 분류
  - 단순 속성과 복합 속성
    - 단순 속성은 고객명, 이메일 등 속성을 더 분해할 수 없는 원자값
    - 복합 속성은 단순 속성들의 조합 ex) 주소 => 기본 주소 + 상세 주소
    - 실제로는 업무 요건이나 모델링 툴의 제약 등으로 복합 속성도 단순속성으로 분리해 표현하기도, 애매한 경우도 많다.
  - 저장 속성과 파생 속성
    - 저장 속성은 원래 존재하는 속성
    - 파생 속성은 저장 속성이나 파생 속성으로부터 파생된 속성 ex) 주문 금액 => 상품 단가 * 주문 수량
    - 일반적으로 파생 속성은 성능적인 목적 등 특수한 경우를 제외하고는 별도로 도출하지 않음
    - 그러나 파생 속성으로 저장하지 않으면 데이터가 변하는 경우에는 파생 속성을 사용해야 함 ex) 주문 이후 상품 단가가 상승
  - 단일 값 속성과 다중 값 속성
    - 단일 값 속성은 하나의 값만 가지는 속성 ex) 사원의 성별, 생일
    - 다중 값 속성은 여러 개의 값을 가지는 속성 ex) 사원의 취미(수영, 독서 등등 여러개 가능)
    - 다중 값 속성은 모델링 과정에서 별도 정규화를 통해 별도 엔티티로 분리됨

식별자
- 식별자는 엔티티에서 인스턴스를 개별적으로 식별할 수 있는 속성(PK?)
- 식별자의 특징
  - 유일성: 엔티티의 모든 인스턴스를 유일하게 식별할 수 있어야 함
  - 최소성: 유일성을 만족하는 최소 속성들로 구성해야 함
  - 불변성: 식별자가 되면 값은 변하지 않아야 함
  - 존재성: 반드시 데이터 값이 존재해야 함
- 고유 속성여부에 따른 분류
  - 본질 식별자
    - 실 세계(업무)에서 일반적으로 통용되는 식별자 ex) 주민등록번호, 사원번호
  - 인조 식별자
    - 업무에서 사용하지는 않지만, 데이터를 효율적으로 관리하기 위해 별도로 추가한 식별자 ex) 주문일련번호, 입출금일련번호
- 대표성 여부에 따른 분류
  - 주 식별자(PK)
  - 대체 식별자(유니크한 값)
